<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI G·ª£i √ù Qu·∫ßn √Åo Theo ƒê·ªô Tu·ªïi</title>

<style>
  body {
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #e3f2fd, #f8f9fa);
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  h2 { color: #1a237e; font-size: 26px; margin-bottom: 10px; }
  .section {
    background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    padding: 20px; margin: 15px auto; max-width: 500px;
  }
  button {
    margin-top: 10px; padding: 10px 15px;
    background: #1a237e; border: none; color: white;
    border-radius: 8px; cursor: pointer; font-size: 15px; transition: background 0.3s;
  }
  button:hover { background: #3949ab; }
  video {
    width: 100%; max-width: 360px; border-radius: 12px; margin-top: 10px;
    border: 3px solid #1a237e; object-fit: cover;
  }
  input[type="file"] {
    padding: 10px; border-radius: 8px; border: 1px solid #999;
    width: 80%; margin-top: 10px;
  }
  #resultBox {
    background: #ffffff; border-radius: 15px; padding: 18px; margin-top: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-align: left;
    max-width: 600px; margin-left: auto; margin-right: auto;
  }
  .warning { color: red; font-weight: bold; margin-top: 10px; }

  /* --- B·ªë c·ª•c 2 c·ªôt cho s·∫£n ph·∫©m --- */
  .product-gallery {
    display: flex; justify-content: space-between; gap: 20px; margin-top: 15px;
  }
  .product-column {
    flex: 1;
    background: #f9fafb;
    border-radius: 12px;
    padding: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .product-column h4 {
    text-align: center;
    color: #1a237e;
    margin-bottom: 10px;
  }
  .product-item {
    display: flex; align-items: center; gap: 10px;
    background: white; margin-bottom: 8px;
    padding: 6px 8px; border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
  .product-item img {
    width: 60px; height: 60px; border-radius: 8px; object-fit: cover;
  }
  .product-item span { font-size: 14px; color: #333; }
</style>
</head>

<body>
<h2>üëï AI G·ª£i √ù Trang Ph·ª•c Theo ƒê·ªô Tu·ªïi</h2>
<p>Ch·ªçn 1 trong 2 c√°ch ƒë·ªÉ h·ªá th·ªëng g·ª£i √Ω qu·∫ßn √°o ph√π h·ª£p:</p>

<div class="section">
  <h3>1Ô∏è‚É£ Nh·∫≠n di·ªán qua Camera</h3>
  <button onclick="startCamera()">B·∫≠t Camera</button>
  <video id="camera" autoplay playsinline></video>
</div>

<div class="section">
  <h3>2Ô∏è‚É£ T·∫£i ·∫£nh khu√¥n m·∫∑t c·ªßa b·∫°n</h3>
  <input type="file" id="imageUpload" accept="image/*">
  <button onclick="predictFromImage()">Nh·∫≠n di·ªán t·ª´ ·∫£nh</button>
  <img id="previewImg" style="width:180px;margin-top:10px;border-radius:10px;display:none;">
</div>

<p class="warning" id="notice">
‚ö†Ô∏è Ch∆∞a c√≥ m√¥ h√¨nh AI. Vui l√≤ng hu·∫•n luy·ªán b·∫±ng Teachable Machine v√† d√°n link v√†o code.
</p>

<div id="resultBox">
  <p><b>ƒê·ªô tu·ªïi d·ª± ƒëo√°n:</b> <span id="predictedAge">Ch∆∞a c√≥</span></p>
  <p><b>Phong c√°ch h·ª£p:</b> <span id="suggestStyle">---</span></p>

  <div id="productGallery" class="product-gallery">
    <div class="product-column" id="leftCol">
      <h4>üëï √Åo</h4>
      <p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>
    </div>
    <div class="product-column" id="rightCol">
      <h4>üëñ Qu·∫ßn & Gi√†y</h4>
      <p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>
    </div>
  </div>
</div>

<!-- TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0"></script>
<!-- Teachable Machine -->
<script src="https://unpkg.com/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<script>
let model, cameraActive = false, predictInterval = null;

const MODEL_URL = "https://teachablemachine.withgoogle.com/models/fCMt4JAgv/";
const LABEL_TO_AGEGROUP = {
  "age_5_12": "5-12",
  "age_13_22": "13-22",
  "age_23_45": "23-45",
  "age_45_plus": "45+"
};
const PRODUCTS = {
  "5-12": [
    {type:"shirt", img:"https://kidstyle.com.vn/images/detailed/4/camcarot_30b3-in.jpg",name:"√Åo thun tr·∫ª em"},
    {type:"shirt", img:"https://cdn.becungshop.vn/images/300x300/ao-khoac-trum-dau-spider-man-cho-be-trai-p24539a19a36d0-300x300.jpg",name:"√Åo kho√°c tr·∫ª em"},
    {type:"shirt", img:"https://cdn.becungshop.vn/images/300x300/ao-khoac-lot-long-giu-nhiet-mua-dong-cho-p5f12b0d5-300x300.jpg",name:"√Åo ·∫•m tr·∫ª em"},
    {type:"shirt", img:"https://sanglaundry.com/wp-content/uploads/2022/11/23b70221aa5e6d00344f.jpg",name:"√Åo len tr·∫ª em"},
    {type:"shirt", img:"https://bizweb.dktcdn.net/100/032/149/files/ao-len-cho-be-trai-1-5-tuoi-c1487-2.jpg?v=1573966425661",name:"√Åo len tr·∫ª em"},

    {type:"pants", img:"https://cf.shopee.vn/file/1ecd9f68d4c9622ab44c52084794a0a5",name:"Qu·∫ßn short"},
    {type:"pants", img:"https://bizweb.dktcdn.net/thumb/1024x1024/100/147/060/products/0212261dkp-020-3-215-2-jpeg.jpg?v=1740825214387",name:"Qu·∫ßn short"},
    {type:"pants", img:"https://bizweb.dktcdn.net/thumb/1024x1024/100/147/060/products/5131025nkp-014-4-220-jpeg.jpg?v=1740825214617",name:"Qu·∫ßn short"},
    {type:"pants", img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSYP29Ox2CmY9droyasFakO-wwhgTA9SYKpUQ&s",name:"Qu·∫ßn short"},
    {type:"pants", img:"https://product.hstatic.net/200000471735/product/quan-short-khaki-xam-g03_1__670ca8476cfa4056a662d00f4002a690_large.jpg",name:"Qu·∫ßn short"},


    {type:"pants", img:"https://bizweb.dktcdn.net/100/172/234/products/giay-the-thao-tre-em-gte-12.jpg?v=1513829630810",name:"Gi√†y th·ªÉ thao"}
  ],
  "13-22": [
    {type:"shirt", img:"https://dosi-in.com/images/detailed/445/dosiin-mvr-maverick-ao-khoac-hoodie-nam-nu-trong-dau-unisex-in-chu-ve-tay-typo-tu-hao-nguoi-viet445225.jpg",name:"√Åo hoodie"},
    {type:"shirt", img:"https://city89.com/wp-content/uploads/2023/03/sm-0010-mockup-black-front.jpg",name:"√Åo thun"},
    {type:"shirt", img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQKGnH0bEzGCRqOCyTcg6_664RjAlmffoZLof_GsTu8DkgnRQWR6usNF-AHYmTg0BKI4k4&usqp=CAU",name:"√Åo thun"},
    {type:"shirt", img:"https://city89.com/wp-content/uploads/2023/03/sm-0011-mockup-white-front.jpg",name:"√Åo thun"},
    {type:"shirt", img:"https://down-vn.img.susercontent.com/file/vn-11134207-7r98o-ly60ti65gcp9ff",name:"√Åo thun"},


    {type:"pants", img:"https://cdn.boo.vn/media/catalog/product/1/_/1.2.21.2.23.001.124.01.60600034_1__4.webp",name:"Qu·∫ßn jeans"},
    {type:"pants", img:"https://bizweb.dktcdn.net/thumb/1024x1024/100/413/756/products/image-1678786611394.png?v=1730995487317",name:"Sneaker"}
  ],
  "23-45": [
    {type:"shirt", img:"https://product.hstatic.net/200000588671/product/ao-so-mi-nam-bycotton-trang-art-nhan_8ec622a241ea4deb93a02bdbdcb87954.jpg",name:"√Åo s∆° mi"},
    {type:"pants", img:"https://polomanor.vn/cdn/shop/files/Polomanor_quanau_sidetab_capcao_xam_21122023_1.jpg?v=1756867748",name:"Qu·∫ßn t√¢y"},
    {type:"pants", img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQmdKUZdgKw5cDqLxsgjVXrYwSyJl8T7Ovbcw&s",name:"Gi√†y c√¥ng s·ªü"}
  ],
  "45+": [
    {type:"shirt", img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT3HhYxNghdQHXOb_o8Z_RbUkY_YM6swv-xfQ&s",name:"√Åo polo"},
    {type:"pants", img:"https://linhvnxk.com/wp-content/uploads/2018/09/quan-kaki-uniqlo-regular-fit-mau-be.jpg",name:"Qu·∫ßn kaki"},
    {type:"pants", img:"https://kaiwings.vn/upload/product/kw-009/giay-doc-nam-da-bo-cao-cap-phoi-do-dep.jpg",name:"Gi√†y da"}
  ]
};

async function loadModel(){
  if(model) return model;
  document.getElementById("notice").innerText = "‚è≥ ƒêang t·∫£i m√¥ h√¨nh AI...";
  try{
    model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
    document.getElementById("notice").innerText = "‚úÖ M√¥ h√¨nh ƒë√£ s·∫µn s√†ng!";
  }catch(e){
    document.getElementById("notice").innerText = "‚ùå L·ªói t·∫£i m√¥ h√¨nh, ki·ªÉm tra URL!";
  }
  return model;
}

async function startCamera(){
  const video = document.getElementById("camera");
  const stream = await navigator.mediaDevices.getUserMedia({video:true});
  video.srcObject = stream;
  cameraActive = true;
  await loadModel();

  if(predictInterval) clearInterval(predictInterval);

  predictInterval = setInterval(async ()=>{
    if(!cameraActive) return;
    const prediction = await model.predict(video);
    prediction.sort((a,b)=>b.probability - a.probability);
    const label = prediction[0].className;
    const ageGroup = LABEL_TO_AGEGROUP[label] || "Kh√¥ng x√°c ƒë·ªãnh";
    updateUI(ageGroup);
  }, 1500);
}

async function predictFromImage(){
  cameraActive = false;
  if(predictInterval) clearInterval(predictInterval);

  const input = document.getElementById("imageUpload");
  const file = input.files[0];
  if(!file) return alert("Vui l√≤ng ch·ªçn ·∫£nh!");
  const img = document.getElementById("previewImg");
  img.src = URL.createObjectURL(file);
  img.style.display = "block";
  
  await loadModel();
  const prediction = await model.predict(img);
  prediction.sort((a,b)=>b.probability - a.probability);
  const label = prediction[0].className;
  const ageGroup = LABEL_TO_AGEGROUP[label] || "Kh√¥ng x√°c ƒë·ªãnh";
  updateUI(ageGroup);
}

function updateUI(ageGroup){
  document.getElementById("predictedAge").innerText = ageGroup;
  let style="", items=PRODUCTS[ageGroup]||[];
  switch(ageGroup){
    case "5-12": style="D·ªÖ th∆∞∆°ng, nƒÉng ƒë·ªông"; break;
    case "13-22": style="Hi·ªán ƒë·∫°i, c√° t√≠nh"; break;
    case "23-45": style="Thanh l·ªãch, chuy√™n nghi·ªáp"; break;
    case "45+": style="Tr∆∞·ªüng th√†nh, gi·∫£n d·ªã"; break;
    default: style="---";
  }
  document.getElementById("suggestStyle").innerText = style;

  const leftCol = document.getElementById("leftCol");
  const rightCol = document.getElementById("rightCol");

  const shirts = items.filter(p => p.type === "shirt");
  const pants = items.filter(p => p.type === "pants");

  leftCol.innerHTML = `<h4>üëï √Åo</h4>` + 
    (shirts.length ? shirts.map(p=>`<div class="product-item"><img src="${p.img}"><span>${p.name}</span></div>`).join("") : "<p>Kh√¥ng c√≥</p>");

  rightCol.innerHTML = `<h4>üëñ Qu·∫ßn & Gi√†y</h4>` + 
    (pants.length ? pants.map(p=>`<div class="product-item"><img src="${p.img}"><span>${p.name}</span></div>`).join("") : "<p>Kh√¥ng c√≥</p>");
}
</script>
</body>
</html>
